
process HCALDQM = { 
	include "DQMServices/Core/data/DQM.cfg"
	replace DQM.collectorHost = "myhost"
	replace DQM.collectorPort = 9092

	module hcalMonitor = HcalMonitorModule{
		# Verbosity Switch
		untracked bool debug = false

		# Choices for prescaling your module (-1 mean no prescale)
		# Operate every N events
		untracked int32 diagnosticPrescaleEvt = -1
		# Operate every N lumi sections
		untracked int32 diagnosticPrescaleLS  = -1
		# Operate every N minutes
		untracked int32 diagnosticPrescaleTime = -1
		# Operate every N updates
		untracked int32 diagnosticPrescaleUpdate = -1


		# Labels for input products
                InputTag digiLabel = hcalDigis
                InputTag hbheRecHitLabel = hbhereco
                InputTag hfRecHitLabel = hfreco
                InputTag hoRecHitLabel = horeco
  	        InputTag gtLabel = l1GtUnpack
                InputTag caloTowerLabel = towerMaker
    
		#Flags for HotCellMonitor.  Thresholds are in GeV

                untracked bool HotCellMonitor = true
                untracked vdouble thresholds={1,1.5,2.,5,15}

                // NADA params updated for Jan DQM challenge using GREN data
                untracked double NADA_Ecand_cut0 = 1.5 // orig values was 1.0
                untracked double NADA_Ecand_cut1 = 2.5 // orig value was 2.5
                untracked double NADA_Ecand_cut2 = 500.
                untracked double NADA_Ecube_cut = 0.5 // orig value was 0.1
                untracked double NADA_Ecell_cut = 0.1
                untracked double NADA_Ecube_frac=0.30 // orig vale was 0.02
                untracked double NADA_Ecell_frac=0.02
                untracked int32 NADA_maxdepth=0
                untracked int32 NADA_maxeta=1
                untracked int32 NADA_maxphi=1
                untracked double NADA_NegCand_cut = -1.5
                
   
                #Flags for DeadCellMonitor
                untracked bool DeadCellMonitor = true
                untracked double coolcellfrac = 0.5 // fraction of cell's neighbors that must be significantly hotter than the cell for the cell to be considered "cool"
                untracked int32 checkNevents = 25 
                untracked double ped_Nsigma = 0
                untracked double minADCcount = 0
                untracked double deadcellfloor = -10. // cells below this energy are automatically set as "cool"
                untracked double deadcellmindiff = 1. // cell must be at least this much below neighbors to be considered a cool cell candidate 

		#Flags for RecHitMonitor.  Threshold is in GeV
	        untracked bool RecHitMonitor = true
	        untracked bool RecHitsPerChannel = false
	        untracked double RecHitOccThresh = 2.0  
	       
		#Flags for DigiMonitor.  Threshold is in ADC counts
		untracked bool DigiMonitor = true
		untracked bool DigisPerChannel = true
		untracked int32 DigiOccThresh = 0

		#Flags for DataFormatMonitor
		untracked bool DataFormatMonitor = true
		untracked int32 dfPrtLvl = 0

		#Flags for MTCCMonitor.  Thresholds are in fC
		#Dump threshold in fC, ranges in iEta/iPhi.  Dumps to stdout
		untracked bool MTCCMonitor = false
		untracked double MTCCOccThresh = 10
		untracked double DumpThreshold = 500
		untracked int32 DumpEtaLow = 0
		untracked int32 DumpEtaHigh = 10
		untracked int32 DumpPhiLow = 10
		untracked int32 DumpPhiHigh = 10
	       
		#Flags for pedestal monitor
	        untracked bool PedestalMonitor = true
	        untracked bool PedestalsPerChannel = true
		untracked bool PedestalsInFC = false

		#Flags for LED monitor
	        untracked bool LEDMonitor = true
	        untracked bool LEDPerChannel = true
		untracked double LED_ADC_Thresh = -1000

		#Flags for TPG monitor
		untracked bool TrigPrimMonitor = true

                #Flags for CaloTower Monitor
                untracked bool CaloTowerMonitor = false

		#Flags for the hcal template analysis
		untracked bool HcalAnalysis = false

		#Global HCAL DQM parameters.  
		#Sets range of iEta/iPhi plots
		untracked double MaxEta = 42.5	
		untracked double MinEta = -42.5	
		untracked double MaxPhi = 73.5	
		untracked double MinPhi = -0.5	

		#List of known hot cells to veto using DetId
		untracked vstring HotCells = {}

                untracked bool checkHB=true
                untracked bool checkHE=true
                untracked bool checkHO=true
                untracked bool checkHF=true

                # HotCell Tags for individual subdetectors
                # If these aren't specified, then the global 
                # values are used

                #untracked bool HBdebug = false
                #untracked bool HEdebug = false
                #untracked bool HOdebug = false
                #untracked bool HFdebug = false

                #untracked vdouble HBthresholds={1,1.5,2.,5,15}
                #untracked vdouble HEthresholds={1,1.5,2.,5,15}
                #untracked vdouble HOthresholds={1,1.5,2.,5,15}
                #untracked vdouble HFthresholds={1,1.5,2.,5,15}

                #untracked double HBMaxEta = 41	
 		#untracked double HBMinEta = -41	
		#untracked double HBMaxPhi = 73	
		#untracked double HBMinPhi = 0	

                #untracked double HEMaxEta = 41	
 		#untracked double HEMinEta = -41	
		#untracked double HEMaxPhi = 73	
		#untracked double HEMinPhi = 0	

                #untracked double HOMaxEta = 41	
 		#untracked double HOMinEta = -41	
		#untracked double HOMaxPhi = 73	
		#untracked double HOMinPhi = 0	

                #untracked double HFMaxEta = 41	
 		#untracked double HFMinEta = -41	
		#untracked double HFMaxPhi = 73	
		#untracked double HFMinPhi = 0	

                #untracked double HB_NADA_Ecand_cut0 = 1.
                #untracked double HB_NADA_Ecand_cut1 = 5.
                #untracked double HB_NADA_Ecand_cut2 = 500.
                #untracked double HB_NADA_Ecube_cut = 0.1
                #untracked double HB_NADA_Ecell_cut = 0.1
                #untracked double HB_NADA_Ecube_frac=0.02
                #untracked double HB_NADA_Ecell_frac=0.02
                #untracked int32 HB_NADA_maxdepth=0
                #untracked int32 HB_NADA_maxeta=1
                #untracked int32 HB_NADA_maxphi=1
                #untracked double HB_NADA_NegCand_cut = -1.5
                
                #untracked double HE_NADA_Ecand_cut0 = 1.
                #untracked double HE_NADA_Ecand_cut1 = 5.
                #untracked double HE_NADA_Ecand_cut2 = 500.
                #untracked double HE_NADA_Ecube_cut = 0.1
                #untracked double HE_NADA_Ecell_cut = 0.1
                #untracked double HE_NADA_Ecube_frac=0.02
                #untracked double HE_NADA_Ecell_frac=0.02
                #untracked int32 HE_NADA_maxdepth=0
                #untracked int32 HE_NADA_maxeta=1
                #untracked int32 HE_NADA_maxphi=1
                #untracked double HE_NADA_NegCand_cut = -1.5
                
                #untracked double HO_NADA_Ecand_cut0 = 1.
                #untracked double HO_NADA_Ecand_cut1 = 5.
                #untracked double HO_NADA_Ecand_cut2 = 500.
                #untracked double HO_NADA_Ecube_cut = 0.1
                #untracked double HO_NADA_Ecell_cut = 0.1
                #untracked double HO_NADA_Ecube_frac=0.02
                #untracked double HO_NADA_Ecell_frac=0.02
                #untracked int32 HO_NADA_maxdepth=0
                #untracked int32 HO_NADA_maxeta=1
                #untracked int32 HO_NADA_maxphi=1
                #untracked double HO_NADA_NegCand_cut = -1.5
                
                #untracked double HF_NADA_Ecand_cut0 = 1.
                #untracked double HF_NADA_Ecand_cut1 = 5.
                #untracked double HF_NADA_Ecand_cut2 = 500.
                #untracked double HF_NADA_Ecube_cut = 0.1
                #untracked double HF_NADA_Ecell_cut = 0.1
                #untracked double HF_NADA_Ecube_frac=0.02
                #untracked double HF_NADA_Ecell_frac=0.02
                #untracked int32 HF_NADA_maxdepth=0
                #untracked int32 HF_NADA_maxeta=1
                #untracked int32 HF_NADA_maxphi=1
                #untracked double HF_NADA_NegCand_cut = -1.5
        }


	module hcalClient =  HcalMonitorClient{
	       	
		# Verbosity Switch
		untracked bool debug = false

		untracked string processName = ""

		# Choices for prescaling your module (-1 mean no prescale)
		# Operate every N events
		untracked int32 diagnosticPrescaleEvt = 200
		# Operate every N lumi sections
		untracked int32 diagnosticPrescaleLS  = -1
		# Operate every N minutes
		untracked int32 diagnosticPrescaleTime = -1
		# Operate every N updates
		untracked int32 diagnosticPrescaleUpdate = -1

		# Are we running as standalone process?
		untracked bool runningStandalone = false

		# Name of input DQM histogram file
		untracked string inputFile = ""

		# Directory for HTML output
        	# Disabled if set to ""
		untracked string baseHtmlDir = '.'


		# Do you want this program to exit at the end of a run?
        	untracked bool enableExit = false

		# Reset histograms on these frequencies
	    	untracked int32 resetFreqUpdates = -1
	   	 untracked int32 resetFreqLS = -1
        	untracked int32 resetFreqEvents = -1
	    	untracked int32 resetFreqTime = -1

		# Analysis jobs to be run
	    	untracked bool DataFormatClient = true
	    	untracked bool DigiClient = true
	    	untracked bool RecHitClient = true
	    	untracked bool HotCellClient = true
       	    	untracked bool DeadCellClient = true
            	# for the moment, don't run CaloTowerClient unless explicitly requested
            	untracked bool CaloTowerClient = false

	    	untracked bool LEDClient = true
        	untracked double LEDRMS_ErrThresh = 0.8
	    	untracked double LEDMEAN_ErrThresh = 2.25

        	untracked bool PedestalClient = true
	    	untracked bool plotPedRAW = true
	    	untracked double PedestalRMS_ErrThresh = 1
	    	untracked double PedestalMean_ErrThresh = 2
	    	untracked double CapIdRMS_ErrThresh = 0.25
	    	untracked double CapIdMEAN_ErrThresh = 1.5

	    	untracked bool DoPerChanTests = false

		#Flags for TPG monitor
		untracked bool TrigPrimClient = true

		#Which subdetectors are present?
	    	untracked vstring subDetsOn = {'HB', 'HE', 'HF', 'HO'}
      }

	include "DQM/HcalMonitorModule/data/Hcal_FrontierConditions_GRuMM.cff"
	include "FWCore/MessageLogger/data/MessageLogger.cfi"

	include "EventFilter/HcalRawToDigi/data/HcalRawToDigi.cfi"
        include "RecoLocalCalo/HcalRecProducers/data/HcalSimpleReconstructor-hbhe.cfi"
        include "RecoLocalCalo/HcalRecProducers/data/HcalSimpleReconstructor-ho.cfi"
        include "RecoLocalCalo/HcalRecProducers/data/HcalSimpleReconstructor-hf.cfi"
	
	path p = { hcalDigis, horeco, hfreco, hbhereco, hcalMonitor, hcalClient, dqmEnv, dqmSaver }

	untracked PSet options = {
		untracked vstring Rethrow = { "ProductNotFound", "TooManyProducts", "TooFewProducts" }
	}
	untracked PSet maxEvents = {untracked int32 input = 100 }
	
	// A run from a calorimeter timing friday in April 2008 
	source = PoolSource {
	        untracked vstring fileNames = {
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/00565C56-ED07-DD11-909A-00304885AB96.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/00B0B16A-ED07-DD11-BC5A-001617E30CD4.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0246C92B-EB07-DD11-A572-001617C3B710.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/02545322-E907-DD11-A3AA-003048560F10.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/042C445D-ED07-DD11-BA74-003048562936.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0460DD46-EB07-DD11-9977-003048562986.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/04BA6152-ED07-DD11-B1CB-00304855D4CE.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0608DD4A-ED07-DD11-A961-000423D98A44.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/064E5C4E-ED07-DD11-9C57-000423D98750.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/068B4B4A-ED07-DD11-BB46-000423D98DB4.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/06923D3A-EB07-DD11-B80E-000423D990CC.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/06C88232-EB07-DD11-A9D1-001617E30D38.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/08BBF948-EB07-DD11-BB91-00304885B0C2.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0A1E3C0D-E907-DD11-B09D-000423D94990.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0A8B432A-E907-DD11-BE1D-00304885AA4E.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0AA3852D-EB07-DD11-98A6-00304855D4E8.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0C03862F-EB07-DD11-BCD1-001617C3B614.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0C11162A-E907-DD11-8CB3-003048562878.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0C786D5D-ED07-DD11-A548-003048561206.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0CC22915-E907-DD11-98A5-001617C3B6DC.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0CEF0136-EB07-DD11-AA10-001617E30D40.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/0EF69608-E907-DD11-90D4-000423D991F0.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/104A250E-EB07-DD11-9B3B-001617E30D2C.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/1062BF38-EB07-DD11-BA2E-003048562880.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/10A26BFE-E807-DD11-94F1-000423DC1A0C.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/12147823-E907-DD11-A492-001617C3B614.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/1433DE26-EB07-DD11-9BAA-003048560F0E.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/147E345B-ED07-DD11-A7C0-003048562986.root',
			'/store/data/GlobalMar08/A/000/000/000/RAW/0000/14B28F0F-EB07-DD11-AA8A-001617C3B614.root'
	        }
	
        }




	// To run on .dat streamer files (you need to change the path to the datafile):
	// source = NewEventStreamFileReader {
        // 	untracked vstring fileNames = {
        // 	    "file:/data1/lookarea/GlobalAug07.00017220.0001.A.storageManager.0.0000.dat",
        // 	    "file:/data1/lookarea/GlobalAug07.00017220.0002.A.storageManager.0.0000.dat",
        // 	    "file:/data1/lookarea/GlobalAug07.00017220.0003.A.storageManager.0.0000.dat"
        // 	}
     	// }
	
	//To run on HCAL local runs:  (you need to have acces to /bigspool or modify the path to the datafile)	
	// source = HcalTBSource {
        //        untracked vstring fileNames = {'file:~/scratch0/USC_042711.root'}
	//        untracked vstring streams = { 
	// 		//HBHE a, b, c:
	// 		'HCAL_DCC700','HCAL_DCC701','HCAL_DCC702','HCAL_DCC703','HCAL_DCC704','HCAL_DCC705',
	// 		'HCAL_DCC706','HCAL_DCC707','HCAL_DCC708','HCAL_DCC709','HCAL_DCC710','HCAL_DCC711',
	// 		'HCAL_DCC712','HCAL_DCC713','HCAL_DCC714','HCAL_DCC715','HCAL_DCC716','HCAL_DCC717',
	// 		//HF:
	// 		'HCAL_DCC718','HCAL_DCC719','HCAL_DCC720','HCAL_DCC721','HCAL_DCC722','HCAL_DCC723',
	// 		//HO:
	// 		'HCAL_DCC724','HCAL_DCC725','HCAL_DCC726','HCAL_DCC727','HCAL_DCC728','HCAL_DCC729',
	// 		'HCAL_DCC730','HCAL_DCC731',
	// 		'HCAL_Trigger','HCAL_SlowData'
	// 	}
	// }	

	#########################################################
 	#### BEGIN DQM Online Environment #######################
	#########################################################
	# use include file for dqmEnv dqmSaver
        include "DQMServices/Components/data/DQMEnvironment.cfi"
        replace dqmSaver.convention       = "Online"
        replace dqmSaver.dirName          = "."
        replace dqmSaver.producer         = "DQM"
        replace dqmEnv.subSystemFolder    = "Hcal"

       # optionally change fileSaving  conditions
       // replace dqmSaver.prescaleLS =   -1
       // replace dqmSaver.prescaleTime = -1 # in minutes
       // replace dqmSaver.prescaleEvt =  -1
       // replace dqmSaver.saveAtRunEnd = true
       // replace dqmSaver.saveAtJobEnd = false
       # will add switch to select histograms to be saved soon
   
    #########################################################
    #### END ################################################
    #########################################################
}
