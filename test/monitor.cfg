process MONITOR = { 

 source = PoolSource {
	untracked vstring fileNames = { 'file:/data/raw/h2.00030593.combined.OutServ_0.0.root'}
	untracked int32 maxEvents = 10000
	untracked vstring streams = { 'HCAL_DCC700:700','HCAL_Trigger','HCAL_SlowData','HCAL_QADCTDC' }
}

//	source = HcalTBSource { 
//        untracked vstring fileNames = { 'file:/home/dqmdevel/tmp_dat/HTB_027221.root'}
//                untracked int32 maxEvents = 5000
//                untracked vstring streams = { 'HCAL_DCC700:700','HCAL_Trigger','HCAL_SlowData','HCAL_QADCTDC' }
//        }

	service = LockService{ untracked vstring labels = {"source"} }
	service = DaqMonitorROOTBackEnd{}
	
	service = MonitorDaemon{
	       #   if true, will automatically start DQM thread in background
	       #  (default: false)
	       untracked bool AutoInstantiate = true

	       # if >=0, upon a connection problem, the source will automatically 
	       # attempt to reconnect with a time delay (secs) specified here 
	       # (default: 5)
	       untracked int32 reconnect_delay = 5

	       # collector hostname
       	       # (default: localhost)
               untracked string DestinationAddress = "localhost"

               # port for communicating with collector
               # (default: 9090)
               untracked int32 SendPort = 9090

               # monitoring period in ms (i.e. how often monitoring elements 
               # are shipped to the collector
               # (default: 1000)
               untracked int32 UpdateDelay = 500

               # name of DQM source
               # (default: DQMSource)
               untracked string NameAsSource = "HcalMonitor"
     }


	module tbMonitor = TBMonitorModule{
	       untracked bool DaqMonitorBEInterface = true
	       untracked bool MonitorDaemon = true
	       untracked bool OffLine = true
	       untracked bool EventPositionMonitor = true
	       untracked bool TimingMonitor = true
	       untracked bool QADCMonitor = true
	       untracked double TimingEnergyThresh = 5
	       untracked vstring hotCells = {'1107321991'}
        }
	
		module hcalMonitor = HcalMonitorModule{
	       untracked bool DaqMonitorBEInterface = true
	       untracked bool MonitorDaemon = false

	      # set this flag true to disable writing a ROOT output file
	       untracked bool disableROOToutput = false
		
		#Must list first FED and list of FEDs to be read out, same as for unpacker
	       int32 HcalFirstFED = 700
               vint32 FEDs = { 719, 721, 723 }

		#Are you running online or offline??
	       untracked bool OffLine = false

		#Flags for HotCellMonitor.  Threshold is in GeV
	       untracked bool HotCellMonitor = true
	       untracked double HotCellThresh0 = 1.0
	       untracked double HotCellThresh1 = 15.0

		#Flags for RecHitMonitor.  Threshold is in GeV
	       untracked bool RecHitMonitor = true
	       untracked bool RecHitsPerChannel = false
	       untracked double RecHitOccThresh = 2.0  
	       
		#Flags for DigiMonitor.  Threshold is in ADC counts
		untracked bool DigiMonitor = true
		untracked bool DigisPerChannel = true
		untracked int32 DigiOccThresh = 0

		#Flags for DataFormatMonitor
		untracked bool DataFormatMonitor = true

		#Flags for MTCCMonitor.  Thresholds are in fC
		#Dump threshold in fC, ranges in iEta/iPhi.  Dumps to stdout
		untracked bool MTCCMonitor = false
		untracked double MTCCOccThresh = 10
		untracked double DumpThreshold = 500
		untracked int32 DumpEtaLow = 0
		untracked int32 DumpEtaHigh = 10
		untracked int32 DumpPhiLow = 10
		untracked int32 DumpPhiHigh = 10
	       
		#Flags for pedestal monitor
	       untracked bool PedestalMonitor = true
	       untracked bool PedestalsPerChannel = true

		#Flags for LED monitor
	       untracked bool LEDMonitor = true
	       untracked bool LEDPerChannel = true
	
		#Flags for Commissioning monitor	
		untracked bool CommissioningMonitor = false

		#Flags for the hcal template analysis
		untracked bool HcalAnalysis = false

		#Global HCAL DQM parameters.  
		#Sets range of iEta/iPhi plots
		untracked double MaxEta = 17.5
		untracked double MinEta = -0.5	
		untracked double MaxPhi = 21.5
		untracked double MinPhi = 8.5	

		#List of known hot cells to veto using DetId
		untracked vstring HotCells = {}
        }     

     	module hcalunpacker = HcalRawToDigi {
                int32 firstSample = 0
                int32 lastSample = 9
                untracked int32 HcalFirstFED = 700
                untracked vint32 FEDs = { 700 }
		bool FilterDataQuality = true
		bool FilterAmplitude = false
		int32 FilterAmpBegin = 4
		int32 FilterAmpEnd = 7
		double FilterAmpLevel = 22.0
		untracked bool UnpackCalib = false	
	}

	module recohbhe = HcalSimpleReconstructor {
	        int32 firstSample = 4
	        int32 samplesToAdd = 4
	        string Subdetector = 'HBHE'
		InputTag digiLabel = hcalunpacker
	        bool correctForTimeslew = true
		bool correctForPhaseContainment = true
		double correctionPhaseNS = 0
	}

	module recoho = HcalSimpleReconstructor {
	        int32 firstSample = 4
	        int32 samplesToAdd = 4
	        string Subdetector = 'HO'
		InputTag digiLabel = hcalunpacker
	        bool correctForTimeslew = false
		bool correctForPhaseContainment = false
		double correctionPhaseNS = 0
	}

	module recohf = HcalSimpleReconstructor {
	        int32 firstSample = 4
	        int32 samplesToAdd = 4
	        string Subdetector = 'HF'
		InputTag digiLabel = hcalunpacker
	        bool correctForTimeslew = false
		bool correctForPhaseContainment = false
		double correctionPhaseNS = 0
	}

	module tbunpacker = HcalTBObjectUnpacker {
	       untracked int32 HcalTriggerFED  = 1
	       untracked int32 HcalSlowDataFED = 3
	       untracked int32 HcalTDCFED      = 8
	       untracked int32 HcalQADCFED      = 8
	       untracked int32 HcalSourcePosFED = -1
	       untracked bool IncludeUnmatchedHits = false
	       untracked string ConfigurationFile = 'configQADCTDC.txt'
	}

	module myfilter = HcalTBTriggerFilter {
                bool AllowPedestal = true
                bool AllowPedestalInSpill = true
                bool AllowPedestalOutSpill = true
                bool AllowLaser = false
                bool AllowLED = true
                bool AllowBeam = true
        }

	path p = { hcalunpacker, recoho, recohf, recohbhe, hcalMonitor}


  es_module = HcalDbProducer {}

  es_source es_hardcode = HcalHardcodeCalibrations { untracked vstring toGet = {"Pedestals", "PedestalWidths", "Gains", "GainWidths", "QIEShape", "QIEData", "ChannelQuality"}}

  es_source es_ascii = HcalTextCalibrations { VPSet input = {
                                             {string object = "ElectronicsMap"
	       	 				FileInPath file = "DQM/HcalMonitorModule/test/emap_tb06_v6.txt"
                                              }
                }
        }

}
